<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>COCORO SHOP | ë°°ì†¡ ì •ë³´</title>

  <!-- ì¹´ì¹´ì˜¤(ë‹¤ìŒ) ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f6fbff;
      --card:rgba(255,255,255,.92);
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#e56aa6;
      --accent2:#7aa7ff;
      --danger:#ef4444;
      --ok:#0f766e;
      --shadow: 0 14px 48px rgba(17,24,39,.10);
      --radius: 18px;

      --season-overlay-opacity:.18;
      --season-glow-1: rgba(229,106,166,.16);
      --season-glow-2: rgba(122,167,255,.14);
      --season-glow-3: rgba(255,210,225,.12);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, sans-serif;
      background:
        radial-gradient(900px 600px at 12% 12%, rgba(229,106,166,.16), transparent 60%),
        radial-gradient(900px 600px at 88% 18%, rgba(122,167,255,.14), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    /* ===== Monthly Theme (auto) overlay ===== */
    body::before{
      content:"";
      position:fixed;
      inset:-40px;
      pointer-events:none;
      z-index:-1;
      opacity: var(--season-overlay-opacity, .18);
      background:
        radial-gradient(900px 600px at 12% 12%, var(--season-glow-1, rgba(229,106,166,.16)), transparent 60%),
        radial-gradient(900px 600px at 88% 18%, var(--season-glow-2, rgba(122,167,255,.14)), transparent 60%),
        radial-gradient(900px 600px at 70% 90%, var(--season-glow-3, rgba(255,210,225,.12)), transparent 60%);
    }

    .wrap{
      width: min(820px, 92vw);
      margin: 26px auto 64px;
    }

    .hero{
      padding: 14px 8px 10px;
      position: relative;
    }

    .top-actions{
      position:absolute;
      right: 6px;
      top: 10px;
      display:flex;
      gap:10px;
    }

    .btn-top{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border: 1px solid rgba(229,106,166,.35);
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 900;
      color:#b84a84;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
    }
    .btn-top:active{ transform: translateY(1px); }

    .brand-row{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom: 10px;
    }
    .mono{
      width:44px; height:44px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(229,106,166,.95), rgba(122,167,255,.95));
      box-shadow: 0 14px 30px rgba(229,106,166,.16);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:950;
      letter-spacing: .8px;
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .mono::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%);
      transform: rotate(12deg);
    }
    .mono span{ position:relative; z-index:1; font-size: 18px; }

    .brand-text{ display:flex; flex-direction:column; line-height:1.1; }
    .brand-name{
      font-weight:950;
      letter-spacing:1px;
      font-size: 14px;
      opacity:.95;
    }

    .title{
      margin: 8px 0 6px;
      font-size: clamp(28px, 4.8vw, 40px);
      font-weight: 980;
      letter-spacing: -0.6px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      line-height: 1.7;
      font-size: 14.5px;
      max-width: 64ch;
    }

    .card{
      margin-top: 14px;
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(229,231,235,.78);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }

    .card-top{
      padding: 14px 18px;
      border-bottom: 1px solid rgba(229,231,235,.78);
      background: linear-gradient(90deg, rgba(229,106,166,.09), rgba(122,167,255,.08));
    }

    .notice{
      font-size: 13.2px;
      color: var(--muted);
      line-height: 1.6;
    }
    .notice b{ color:#374151; }

    .form{ padding: 18px; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    @media (max-width: 640px){
      .wrap{ margin: 18px auto 46px; }
      .grid{ grid-template-columns: 1fr; }
      .form{ padding: 16px; }
      .card-top{ padding: 13px 16px; }
      .top-actions{ position:static; margin-bottom: 12px; justify-content:flex-end; }
    }

    .field{ display:flex; flex-direction:column; gap: 6px; }
    label{
      font-size: 14px;
      font-weight: 900;
      letter-spacing: -.1px;
    }
    .hint{ font-size: 12.5px; color: var(--muted); line-height:1.45; }

    input, textarea{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 16px; /* ëª¨ë°”ì¼ ìë™ í™•ëŒ€ ë°©ì§€ */
      outline:none;
      background:#fff;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus, textarea:focus{
      border-color: rgba(229,106,166,.55);
      box-shadow: 0 0 0 4px rgba(229,106,166,.13);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .readonly{ background: rgba(243,244,246,.75); }

    .row{
      display:flex;
      gap: 10px;
      align-items: stretch;
    }
    .row > *{ flex:1; }

    .btn{
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 950;
      cursor:pointer;
      min-height: 48px;
      transition: filter .15s ease, transform .05s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-outline{
      background:#fff;
      border:1px solid rgba(229,106,166,.40);
      color:#b84a84;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff;
      box-shadow: 0 12px 24px rgba(229,106,166,.16);
    }
    .btn-ghost{
      background: rgba(255,255,255,.7);
      border: 1px solid rgba(229,231,235,.8);
      color:#374151;
      font-weight: 900;
    }

    .actions{
      margin-top: 16px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    @media (max-width: 640px){
      .actions{ flex-direction: column; }
    }

    /* ì—ëŸ¬ */
    .error-box{
      display:none;
      border: 1px solid rgba(239,68,68,.35);
      background: rgba(239,68,68,.06);
      color:#991b1b;
      padding: 12px 12px;
      border-radius: 14px;
      margin-bottom: 12px;
      line-height: 1.55;
      font-size: 14px;
    }
    .field.invalid input,
    .field.invalid textarea{
      border-color: rgba(239,68,68,.55);
      box-shadow: 0 0 0 4px rgba(239,68,68,.12);
    }
    .field .err{
      display:none;
      color: var(--danger);
      font-size: 12.5px;
      font-weight: 900;
    }
    .field.invalid .err{ display:block; }

    .status{
      margin-top: 12px;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
      min-height: 22px;
    }
    .status.ok{ color:var(--ok); font-weight: 950; }
    .status.bad{ color:#b91c1c; font-weight: 950; }

    .hidden{ display:none !important; }

    /* ì˜¤ë°°ì†¡ ì²´í¬ */
    .checkwrap{
      margin-top: 14px;
      border:1px solid rgba(229,231,235,.9);
      border-radius: 16px;
      background: rgba(255,255,255,.7);
      padding: 12px 12px;
      display:flex;
      gap: 10px;
      align-items:flex-start;
    }
    .checkwrap input{ width:20px; height:20px; margin-top: 2px; }
    .checkwrap .ctitle{ font-weight: 950; }
    .checkwrap .csub{ color: var(--muted); font-size: 13px; line-height: 1.45; margin-top: 3px; }

    /* ì ‘ìˆ˜ì¦ ì¹´ë“œ */
    .receipt-shell{
      padding: 18px;
    }
    .receipt-banner{
      display:flex;
      gap:10px;
      align-items:center;
      color: var(--ok);
      font-weight: 980;
      margin-bottom: 10px;
    }
    .receipt-card{
      background: #fff;
      border: 1px solid rgba(229,231,235,.95);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 10px 26px rgba(17,24,39,.08);
      position: relative;
      overflow:hidden;
    }
    .receipt-card::before{
      content:"";
      position:absolute;
      inset:-60px;
      background:
        radial-gradient(420px 260px at 10% 10%, rgba(229,106,166,.12), transparent 60%),
        radial-gradient(420px 260px at 90% 10%, rgba(122,167,255,.10), transparent 60%);
      pointer-events:none;
    }
    .receipt-head{
      position:relative;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 1px dashed rgba(229,231,235,.95);
      margin-bottom: 12px;
    }
    .receipt-brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight: 980;
      letter-spacing: .8px;
    }
    .receipt-meta{
      text-align:right;
      color: var(--muted);
      font-size: 12.8px;
      line-height: 1.45;
      font-weight: 800;
    }
    .receipt-grid{
      position:relative;
      display:grid;
      grid-template-columns: 110px 1fr;
      gap: 10px 12px;
      align-items:start;
    }
    .rk{ color: var(--muted); font-weight: 900; }
    .rv{ font-weight: 980; }
    .receipt-note{
      margin-top: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    /* ì£¼ì†Œ ê²€ìƒ‰ ëª¨ë‹¬(ì¤‘ì•™) */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background: rgba(17,24,39,.45);
      backdrop-filter: blur(4px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 9999;
      padding: 18px;
    }
    .modal{
      width: min(520px, 96vw);
      height: min(560px, 88vh);
      background:#fff;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
    }
    .modal-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(229,231,235,.9);
      background: linear-gradient(90deg, rgba(229,106,166,.08), rgba(122,167,255,.08));
      font-weight: 950;
    }
    .modal-close{
      border:none;
      background: rgba(255,255,255,.8);
      border: 1px solid rgba(229,231,235,.9);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 950;
    }
    .modal-body{ flex:1; }
    #postcodeWrap{ width:100%; height:100%; }
  
  /* ì£¼ì†Œ ì°¾ê¸° ë²„íŠ¼ë§Œ ê³ ì •í­ìœ¼ë¡œ */
.addr-row .btn-find{
  flex: 0 0 auto;   /* ëŠ˜ì–´ë‚˜ì§€ ì•Šê²Œ */
  width: 140px;     /* ë²„íŠ¼ í­(ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ì¡°ì ˆ ê°€ëŠ¥: 120~160 ì¶”ì²œ) */
  padding: 12px 12px;
}

/* ëª¨ë°”ì¼ì—ì„œëŠ” ë²„íŠ¼ì´ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë©´ì„œ 100% */
@media (max-width: 640px){
  .addr-row .btn-find{
    width: 100%;
  }
}
  
  </style>
</head>

<body>
  <div class="wrap">
    <!-- ===== FORM HERO ===== -->
    <header class="hero" id="heroForm">
      <div class="top-actions">
        <a class="btn-top" href="./status.html">ğŸ” ì ‘ìˆ˜ ì¡°íšŒ</a>
      </div>

      <div class="brand-row">
        <div class="mono" aria-hidden="true"><span>C</span></div>
        <div class="brand-text">
          <div class="brand-name">COCORO SHOP</div>
        </div>
      </div>

      <h1 class="title">ë°°ì†¡ ì •ë³´</h1>
      <p class="subtitle">
        ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì„ ì •í™•í•˜ê³  ì•ˆì „í•˜ê²Œ ë³´ë‚´ê¸° ìœ„í•´ ë°°ì†¡ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br/>
        ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” <b>ë°°ì†¡ ì²˜ë¦¬ ëª©ì </b>ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
      </p>
    </header>

    <!-- ===== RECEIPT HERO (í¼ ì œì¶œ í›„ì—ëŠ” ì´ìª½ë§Œ ë³´ì—¬ì¤Œ) ===== -->
    <header class="hero hidden" id="heroReceipt">
      <div class="top-actions">
        <a class="btn-top" id="topStatusLink" href="./status.html">ğŸ” ì ‘ìˆ˜ ì¡°íšŒ</a>
      </div>

      <div class="brand-row">
        <div class="mono" aria-hidden="true"><span>C</span></div>
        <div class="brand-text">
          <div class="brand-name">COCORO SHOP</div>
        </div>
      </div>

      <h1 class="title">ì ‘ìˆ˜ ì™„ë£Œ</h1>
      <p class="subtitle">
        ì•„ë˜ ì ‘ìˆ˜ì¦ì„ ì €ì¥í•´ë‘ì‹œë©´, ë‚˜ì¤‘ì— â€œì ‘ìˆ˜ ì¡°íšŒâ€ì—ì„œ ìƒíƒœ/ì†¡ì¥ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.
      </p>
    </header>

    <!-- ===== FORM CARD ===== -->
    <section class="card" aria-label="ë°°ì†¡ ì •ë³´ ì…ë ¥ í¼" id="formCard">
      <div class="card-top">
        <div class="notice">
          ğŸ’¡ <b>ìš”ì²­ì‚¬í•­ì„ ì œì™¸í•œ ëª¨ë“  í•­ëª©ì€ í•„ìˆ˜</b>ì…ë‹ˆë‹¤.<br/>
          â€˜ì…ë ¥ ì™„ë£Œâ€™ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëˆ„ë½ëœ í•­ëª©ì„ ì•ˆë‚´í•´ë“œë ¤ìš”.
        </div>
      </div>

      <div class="form">
        <div id="errorBox" class="error-box"></div>

        <form id="form" novalidate>
          <div class="grid">
            <div class="field" id="f_customerName">
              <label for="customerName">ë°›ëŠ” ë¶„ ì„±í•¨</label>
              <input type="text" id="customerName" placeholder="ì˜ˆ: ê¹€ì„œì—°" autocomplete="name" />
              <div class="hint">ì‹¤ëª… ì…ë ¥ì„ ê¶Œì¥í•´ìš”. (ì˜¤ë°°ì†¡/ë°˜ì†¡ ë°©ì§€)</div>
              <div class="err">ë°›ëŠ” ë¶„ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
            </div>

            <div class="field" id="f_phone">
              <label for="phone">ì—°ë½ì²˜</label>
              <input type="tel" id="phone" placeholder="ì˜ˆ: 010-1234-5678 / 02-123-4567" inputmode="tel" autocomplete="tel" />
              <div class="hint">íœ´ëŒ€í° ë˜ëŠ” ì§€ì—­ë²ˆí˜¸ í¬í•¨ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
              <div class="err">ì—°ë½ì²˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
            </div>

            <!-- ë‚´ë¶€ ì €ì¥ìš© (ìˆ¨ê¹€) -->
            <input type="hidden" id="postcode" />
            <input type="hidden" id="fullAddress" />
            <input type="text" id="website" class="hidden" tabindex="-1" autocomplete="off" />

            <div class="field" id="f_address" style="grid-column: 1 / -1;">
              <label for="baseAddress">ì£¼ì†Œ</label>
              <div class="row addr-row">
  <input type="text" id="baseAddress" class="readonly" readonly placeholder="â€˜ì£¼ì†Œ ì°¾ê¸°â€™ë¡œ ê²€ìƒ‰í•´ì£¼ì„¸ìš”" />
  <button type="button" class="btn btn-outline btn-find" onclick="openPostcode()">ğŸ” ì£¼ì†Œ ì°¾ê¸°</button>
</div>
              <div class="hint">ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ìš”.</div>
              <div class="err">ì£¼ì†Œ ì°¾ê¸°ë¥¼ ëˆŒëŸ¬ ì£¼ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
            </div>

            <div class="field" id="f_detailAddress" style="grid-column: 1 / -1;">
              <label for="detailAddress">ìƒì„¸ì£¼ì†Œ</label>
              <input type="text" id="detailAddress" placeholder="ë™/í˜¸ìˆ˜, ìƒí˜¸ëª…, ì¸µìˆ˜ ë“±" autocomplete="street-address" />
              <div class="hint">ì˜ˆ: 101ë™ 1203í˜¸ / COCORO ë¹Œë”© 1ì¸µ</div>
              <div class="err">ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
            </div>
          </div>

          <div class="field" id="f_request" style="margin-top: 14px;">
            <label for="request">ìš”ì²­ì‚¬í•­ (ì„ íƒ)</label>
            <textarea id="request" placeholder="ì˜ˆ: ë¶€ì¬ì‹œ ë¬¸ ì•ì— ë†“ì•„ì£¼ì„¸ìš” / ê²½ë¹„ì‹¤ ë§¡ê²¨ì£¼ì„¸ìš”"></textarea>
          </div>

          <div class="field" id="f_confirm">
            <div class="checkwrap">
              <input type="checkbox" id="confirmCheck" />
              <div>
                <div class="ctitle">ì˜¤ë°°ì†¡ ë°©ì§€ í™•ì¸ â€” ì…ë ¥í•œ ì„±í•¨/ì—°ë½ì²˜/ì£¼ì†Œê°€ ì •í™•í•œê°€ìš”?</div>
                <div class="csub">ì…ë ¥ ì™„ë£Œ ì „ ê¼­ í•œ ë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
                <div class="err" style="margin-top:6px;">ì˜¤ë°°ì†¡ ë°©ì§€ í™•ì¸ì— ì²´í¬í•´ì£¼ì„¸ìš”.</div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">ì…ë ¥ ì™„ë£Œ</button>
          </div>

          <div id="status" class="status" aria-live="polite"></div>
        </form>
      </div>
    </section>

    <!-- ===== RECEIPT CARD (ì œì¶œ ì„±ê³µ í›„ì—ë§Œ í‘œì‹œ) ===== -->
    <section class="card hidden" id="receiptCard">
      <div class="receipt-shell">
        <div class="receipt-banner">âœ… ì ‘ìˆ˜ ì™„ë£Œ</div>

        <div class="receipt-card" id="receiptArea">
          <div class="receipt-head">
            <div class="receipt-brand">
              <div class="mono" style="width:38px;height:38px;border-radius:14px;box-shadow:none;"><span>C</span></div>
              <div>COCORO SHOP</div>
            </div>
            <div class="receipt-meta">
              <div>ì ‘ìˆ˜ë²ˆí˜¸: <span id="r_receipt" style="color:#374151;font-weight:980;"></span></div>
              <div>ì ‘ìˆ˜ì‹œê°„: <span id="r_time"></span></div>
            </div>
          </div>

          <div class="receipt-grid">
            <div class="rk">ë°›ëŠ” ë¶„</div><div class="rv" id="r_name"></div>
            <div class="rk">ì—°ë½ì²˜</div><div class="rv" id="r_phone"></div>
            <div class="rk">ì£¼ì†Œ</div><div class="rv" id="r_address"></div>
            <div class="rk">ìš”ì²­ì‚¬í•­</div><div class="rv" id="r_request"></div>
            <div class="rk">ìƒíƒœ</div><div class="rv">ì ‘ìˆ˜</div>
            <!--
            <div class="rk">ì ‘ìˆ˜ ì¡°íšŒ</div>
            <div class="rv">
              <a id="r_statusLink" href="./status.html" style="font-weight:980;color:#b84a84;text-decoration:underline;">ì ‘ìˆ˜ ì¡°íšŒ</a>
            </div>
            -->
          </div>
        </div>

        <div class="receipt-note">
          ìˆ˜ì •ì´ í•„ìš”í•˜ì‹  ê²½ìš° ì¸ìŠ¤íƒ€ DMìœ¼ë¡œ <b>ì ‘ìˆ˜ë²ˆí˜¸</b>ì™€ ìˆ˜ì • ë‚´ìš©ì„ ë³´ë‚´ì£¼ì„¸ìš”.<br/>
          ì¡°íšŒëŠ” â€œì ‘ìˆ˜ ì¡°íšŒâ€ì—ì„œ <b>ì ‘ìˆ˜ë²ˆí˜¸ë§Œ</b> ì…ë ¥í•˜ë©´ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
        </div>

        <div class="actions" style="margin-top:14px;">
          <button class="btn btn-ghost" type="button" id="copyReceiptBtn">ì ‘ìˆ˜ë²ˆí˜¸ ë³µì‚¬</button>
          <a class="btn btn-ghost" id="goStatusBtn" href="./status.html" style="text-decoration:none;display:inline-flex;justify-content:center;align-items:center;">ì ‘ìˆ˜ ì¡°íšŒ</a>
          <button class="btn btn-primary" type="button" id="savePngBtn">ì ‘ìˆ˜ì¦ ì €ì¥</button>
<!--          <button class="btn btn-outline" type="button" id="newEntryBtn">ë‹¤ì‹œ ì…ë ¥</button>  -->
        </div>

        <div id="receiptStatus" class="status" style="margin-top:10px;"></div>
      </div>
    </section>
  </div>

  <!-- ì£¼ì†Œê²€ìƒ‰ ëª¨ë‹¬(ì¤‘ì•™) -->
  <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="ì£¼ì†Œ ê²€ìƒ‰">
      <div class="modal-top">
        <div>ì£¼ì†Œ ê²€ìƒ‰</div>
        <button class="modal-close" type="button" onclick="closePostcode()">ë‹«ê¸°</button>
      </div>
      <div class="modal-body">
        <div id="postcodeWrap"></div>
      </div>
    </div>
  </div>

  <script>
    // ===== Monthly Theme (auto) =====
    (function applyMonthlyTheme(){
      const m = new Date().getMonth() + 1; // 1~12
      const root = document.documentElement;

      const base = {
        '--bg1': '#fff7fb',
        '--bg2': '#f6fbff',
        '--accent': '#e56aa6',
        '--accent2': '#7aa7ff',
        '--season-overlay-opacity': '.18',
        '--season-glow-1': 'rgba(229,106,166,.16)',
        '--season-glow-2': 'rgba(122,167,255,.14)',
        '--season-glow-3': 'rgba(255,210,225,.12)',
      };

      const themes = {
        1: {'--bg1':'#fbfcff','--bg2':'#f4f7ff','--accent':'#6b7cff','--accent2':'#c3d0ff','--season-glow-1':'rgba(107,124,255,.14)','--season-glow-2':'rgba(195,208,255,.18)','--season-glow-3':'rgba(240,244,255,.18)'},
        2: {'--bg1':'#fff6fb','--bg2':'#f7fbff','--accent':'#e56aa6','--accent2':'#ffb6c9','--season-glow-1':'rgba(229,106,166,.18)','--season-glow-2':'rgba(255,182,201,.18)','--season-glow-3':'rgba(200,230,255,.12)'},
        3: {'--bg1':'#fff7f3','--bg2':'#f5fbff','--accent':'#d86bb9','--accent2':'#ffb38a','--season-glow-1':'rgba(216,107,185,.16)','--season-glow-2':'rgba(255,179,138,.14)','--season-glow-3':'rgba(186,235,255,.12)'},
        4: {'--bg1':'#fff3f8','--bg2':'#fffdf6','--accent':'#e46b9a','--accent2':'#ffd3e1','--season-glow-1':'rgba(228,107,154,.16)','--season-glow-2':'rgba(255,211,225,.22)','--season-glow-3':'rgba(255,245,219,.18)'},
        5: {'--bg1':'#f3fff7','--bg2':'#f5fbff','--accent':'#2fb7a3','--accent2':'#7aa7ff','--season-glow-1':'rgba(47,183,163,.14)','--season-glow-2':'rgba(122,167,255,.12)','--season-glow-3':'rgba(190,255,225,.14)'},
        6: {'--bg1':'#f4fffe','--bg2':'#f5f6ff','--accent':'#6c7bff','--accent2':'#35c9c0','--season-glow-1':'rgba(108,123,255,.14)','--season-glow-2':'rgba(53,201,192,.14)','--season-glow-3':'rgba(200,210,255,.14)'},
        7: {'--bg1':'#f2fbff','--bg2':'#f6fffe','--accent':'#1aa7d7','--accent2':'#35c9c0','--season-glow-1':'rgba(26,167,215,.14)','--season-glow-2':'rgba(53,201,192,.14)','--season-glow-3':'rgba(175,240,255,.14)'},
        8: {'--bg1':'#fff6f0','--bg2':'#f2fbff','--accent':'#ff8a7a','--accent2':'#5aa6ff','--season-glow-1':'rgba(255,138,122,.14)','--season-glow-2':'rgba(90,166,255,.12)','--season-glow-3':'rgba(255,210,175,.12)'},
        9: {'--bg1':'#fffaf2','--bg2':'#f7f2ff','--accent':'#a56bd8','--accent2':'#f2c79a','--season-glow-1':'rgba(165,107,216,.12)','--season-glow-2':'rgba(242,199,154,.14)','--season-glow-3':'rgba(255,241,210,.16)'},
        10:{'--bg1':'#fff7f0','--bg2':'#fffdf6','--accent':'#d26a4a','--accent2':'#f2c79a','--season-glow-1':'rgba(210,106,74,.14)','--season-glow-2':'rgba(242,199,154,.14)','--season-glow-3':'rgba(255,235,210,.16)'},
        11:{'--bg1':'#fff6f7','--bg2':'#f7f2ef','--accent':'#a8566a','--accent2':'#caa07a','--season-glow-1':'rgba(168,86,106,.14)','--season-glow-2':'rgba(202,160,122,.14)','--season-glow-3':'rgba(245,230,218,.16)'},
        12:{'--bg1':'#fff7fb','--bg2':'#f4f7ff','--accent':'#e11d48','--accent2':'#7aa7ff','--season-glow-1':'rgba(225,29,72,.12)','--season-glow-2':'rgba(122,167,255,.12)','--season-glow-3':'rgba(255,210,225,.12)'},
      };

      const t = { ...base, ...(themes[m] || {}) };
      Object.entries(t).forEach(([k,v]) => root.style.setProperty(k, v));
    })();

    // ===== API (Vercel/Netlify ê³µí†µ) =====
    const submitUrl = "/api/submit"; // âœ… NetlifyëŠ” netlify.toml ë¦¬ë¼ì´íŠ¸ë¡œ í•¨ìˆ˜ë¡œ ì—°ê²°ë¨

    function setStatus(msg, type){
      const el = document.getElementById('status');
      el.classList.remove('ok','bad');
      if(type === 'ok') el.classList.add('ok');
      if(type === 'bad') el.classList.add('bad');
      el.textContent = msg || '';
    }

    function setReceiptStatus(msg, type){
      const el = document.getElementById('receiptStatus');
      el.classList.remove('ok','bad');
      if(type === 'ok') el.classList.add('ok');
      if(type === 'bad') el.classList.add('bad');
      el.textContent = msg || '';
    }

    function clearErrors(){
      document.getElementById('errorBox').style.display = 'none';
      document.getElementById('errorBox').innerHTML = '';
      document.querySelectorAll('.field').forEach(f => f.classList.remove('invalid'));
      document.getElementById('f_confirm').classList.remove('invalid');
      document.querySelector('#f_confirm .err').style.display = 'none';
    }

    function showErrors(missingLabels){
      const box = document.getElementById('errorBox');
      box.style.display = 'block';
      box.innerHTML = `ì•„ë˜ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”:<br><b>â€¢ ${missingLabels.join('<br>â€¢ ')}</b>`;
      box.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function digitsOnly(v){ return String(v||'').replace(/\D/g,''); }

    // í•œêµ­ ì „í™”ë²ˆí˜¸ ìœ íš¨ì„±(íœ´ëŒ€í°/ì§€ì—­ë²ˆí˜¸ ëª¨ë‘ í—ˆìš©)
    function isValidKRTel(input){
      const d = digitsOnly(input);
      if(!d.startsWith('0')) return false;
      if(d.length < 9 || d.length > 11) return false;

      // 02(ì„œìš¸) 9~10ìë¦¬
      if(d.startsWith('02')) return (d.length === 9 || d.length === 10);

      // íœ´ëŒ€í° 010/011/016/017/018/019: 10~11ìë¦¬
      if(/^01[016789]/.test(d)) return (d.length === 10 || d.length === 11);

      // ì¼ë°˜ ì§€ì—­ë²ˆí˜¸(0xx): 10~11ìë¦¬
      if(/^0\d{2}/.test(d)) return (d.length === 10 || d.length === 11);

      return false;
    }

    // ë³´ê¸° ì¢‹ê²Œ ìë™ í•˜ì´í”ˆ(ì…ë ¥ í¸ì˜)
    function formatKRTel(v){
      const d = digitsOnly(v).slice(0, 11);
      if(d.startsWith('02')){
        if(d.length <= 2) return d;
        if(d.length <= 5) return d.replace(/(\d{2})(\d{1,3})/, '$1-$2');
        if(d.length <= 9) return d.replace(/(\d{2})(\d{3})(\d{1,4})/, '$1-$2-$3');
        return d.replace(/(\d{2})(\d{4})(\d{1,4})/, '$1-$2-$3');
      }else{
        if(d.length <= 3) return d;
        if(d.length <= 7) return d.replace(/(\d{3})(\d{1,4})/, '$1-$2');
        return d.replace(/(\d{3})(\d{3,4})(\d{1,4})/, '$1-$2-$3');
      }
    }

    function updateFullAddress(){
      const base = document.getElementById('baseAddress').value.trim();
      const detail = document.getElementById('detailAddress').value.trim();
      document.getElementById('fullAddress').value = detail ? `${base} ${detail}` : base;
    }

    document.getElementById('detailAddress').addEventListener('input', updateFullAddress);
    document.getElementById('phone').addEventListener('input', (e)=>{
      const formatted = formatKRTel(e.target.value);
      if(e.target.value !== formatted) e.target.value = formatted;
    });

    // ===== Daum Postcode: ì¤‘ì•™ ëª¨ë‹¬ embed =====
    let postcodeInstance = null;
    function openPostcode(){
      const backdrop = document.getElementById('modalBackdrop');
      const wrap = document.getElementById('postcodeWrap');

      wrap.innerHTML = "";
      backdrop.style.display = "flex";

      postcodeInstance = new daum.Postcode({
        oncomplete: (data) => {
          document.getElementById('postcode').value = data.zonecode || '';
          document.getElementById('baseAddress').value = data.address || '';
          document.getElementById('detailAddress').focus();
          updateFullAddress();
          closePostcode();
        },
        onclose: () => { /* ì‚¬ìš©ìê°€ ë‹«ì€ ê²½ìš° */ }
      });

      // embedë¡œ ëª¨ë‹¬ ì¤‘ì•™ì— í‘œì‹œ
      postcodeInstance.embed(wrap);
    }
    function closePostcode(){
      document.getElementById('modalBackdrop').style.display = "none";
      const wrap = document.getElementById('postcodeWrap');
      wrap.innerHTML = "";
      postcodeInstance = null;
    }
    window.openPostcode = openPostcode;
    window.closePostcode = closePostcode;

    // ===== í™”ë©´ ì „í™˜: í¼ â†’ ì ‘ìˆ˜ì¦ =====
    function showReceiptScreen(){
      document.getElementById('heroForm').classList.add('hidden');
      document.getElementById('formCard').classList.add('hidden');

      document.getElementById('heroReceipt').classList.remove('hidden');
      document.getElementById('receiptCard').classList.remove('hidden');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showFormScreen(){
      document.getElementById('heroReceipt').classList.add('hidden');
      document.getElementById('receiptCard').classList.add('hidden');

      document.getElementById('heroForm').classList.remove('hidden');
      document.getElementById('formCard').classList.remove('hidden');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ===== í´ë¦½ë³´ë“œ =====
    async function copyText(t){
      try{
        await navigator.clipboard.writeText(t);
        return true;
      }catch{
        // fallback
        const ta = document.createElement('textarea');
        ta.value = t;
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand('copy');
        ta.remove();
        return ok;
      }
    }

    // ===== ì ‘ìˆ˜ì¦ PNG ì €ì¥(ìº”ë²„ìŠ¤) =====
    function downloadReceiptPng(payload){
      // payload: {receiptTitle, timeText, name, phone, address, request}
      const w = 1100;
      const h = 620;
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');

      // ë°°ê²½
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,w,h);

      // ìƒë‹¨ ë¼ì¸/í¬ì¸íŠ¸
      const grad = ctx.createLinearGradient(0,0,w,0);
      grad.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || "#e56aa6");
      grad.addColorStop(1, getComputedStyle(document.documentElement).getPropertyValue('--accent2').trim() || "#7aa7ff");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,w,10);

      // ë¸Œëœë“œ
      ctx.fillStyle = "#111827";
      ctx.font = "bold 38px Arial";
      ctx.fillText("COCORO SHOP", 48, 70);

      ctx.fillStyle = "#6b7280";
      ctx.font = "bold 22px Arial";
      ctx.fillText("ì ‘ìˆ˜ì¦", 48, 108);

      // ìš°ì¸¡ ë©”íƒ€
      ctx.textAlign = "right";
      ctx.fillStyle = "#374151";
      ctx.font = "bold 22px Arial";
      ctx.fillText(`ì ‘ìˆ˜ë²ˆí˜¸: ${payload.receiptTitle}`, w-48, 70);
      ctx.fillStyle = "#6b7280";
      ctx.font = "bold 20px Arial";
      ctx.fillText(`ì ‘ìˆ˜ì‹œê°„: ${payload.timeText}`, w-48, 104);
      ctx.textAlign = "left";

      // êµ¬ë¶„ì„ 
      ctx.strokeStyle = "#e5e7eb";
      ctx.setLineDash([6,6]);
      ctx.beginPath();
      ctx.moveTo(48, 140);
      ctx.lineTo(w-48, 140);
      ctx.stroke();
      ctx.setLineDash([]);

      // ë‚´ìš©
      const leftK = 80;
      const leftV = 230;
      let y = 210;
      const rowGap = 68;

      const labelStyle = () => { ctx.fillStyle="#6b7280"; ctx.font="bold 24px Arial"; };
      const valueStyle = () => { ctx.fillStyle="#111827"; ctx.font="bold 28px Arial"; };

      labelStyle(); ctx.fillText("ë°›ëŠ” ë¶„", leftK, y);
      valueStyle(); ctx.fillText(payload.name, leftV, y);

      y += rowGap;
      labelStyle(); ctx.fillText("ì—°ë½ì²˜", leftK, y);
      valueStyle(); ctx.fillText(payload.phone, leftV, y);

      y += rowGap;
      labelStyle(); ctx.fillText("ì£¼ì†Œ", leftK, y);
      valueStyle(); wrapText(ctx, payload.address, leftV, y, w-48-leftV, 32);

      y += rowGap + 20;
      labelStyle(); ctx.fillText("ìš”ì²­ì‚¬í•­", leftK, y);
      valueStyle(); ctx.fillText(payload.request || "ì—†ìŒ", leftV, y);

      y += rowGap;
      labelStyle(); ctx.fillText("ìƒíƒœ", leftK, y);
      valueStyle(); ctx.fillText("ì ‘ìˆ˜", leftV, y);

      // í•˜ë‹¨ ì•ˆë‚´
      // ctx.fillStyle="#6b7280";
      // ctx.font="bold 20px Arial";
      // ctx.fillText("ì ‘ìˆ˜ ì¡°íšŒ: status.htmlì—ì„œ ì ‘ìˆ˜ë²ˆí˜¸ë¡œ í™•ì¸ ê°€ëŠ¥", 48, h-50);

      const url = canvas.toDataURL("image/png");
      const a = document.createElement('a');
      a.href = url;
      a.download = `COCORO_ì ‘ìˆ˜ì¦_${payload.receiptTitle}.png`;
      a.click();
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = String(text||'').split(' ');
      let line = '';
      let yy = y;
      for(let n=0;n<words.length;n++){
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if(metrics.width > maxWidth && n>0){
          ctx.fillText(line, x, yy);
          line = words[n] + ' ';
          yy += lineHeight;
        }else{
          line = testLine;
        }
      }
      ctx.fillText(line, x, yy);
    }

    // ===== ì œì¶œ =====
    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearErrors();
      setStatus('');
      setReceiptStatus('');

      const customerName = document.getElementById('customerName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const postcode = document.getElementById('postcode').value.trim();
      const baseAddress = document.getElementById('baseAddress').value.trim();
      const detailAddress = document.getElementById('detailAddress').value.trim();
      updateFullAddress();
      const fullAddress = document.getElementById('fullAddress').value.trim();
      const request = document.getElementById('request').value.trim();
      const website = document.getElementById('website').value.trim();
      const confirmCheck = document.getElementById('confirmCheck').checked;

      const missing = [];

      if(!customerName){
        document.getElementById('f_customerName').classList.add('invalid');
        missing.push('ë°›ëŠ” ë¶„ ì„±í•¨');
      }
      if(!phone || !isValidKRTel(phone)){
        document.getElementById('f_phone').classList.add('invalid');
        missing.push('ì—°ë½ì²˜(í˜•ì‹ í™•ì¸)');
      }
      if(!postcode || !baseAddress){
        document.getElementById('f_address').classList.add('invalid');
        missing.push('ì£¼ì†Œ(ì£¼ì†Œ ì°¾ê¸°)');
      }
      if(!detailAddress){
        document.getElementById('f_detailAddress').classList.add('invalid');
        missing.push('ìƒì„¸ì£¼ì†Œ');
      }
      if(!confirmCheck){
        document.getElementById('f_confirm').classList.add('invalid');
        document.querySelector('#f_confirm .err').style.display = 'block';
        missing.push('ì˜¤ë°°ì†¡ ë°©ì§€ í™•ì¸(ì²´í¬)');
      }

      if(missing.length){
        showErrors(missing);
        setStatus('í•„ìˆ˜ í•­ëª©ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'bad');
        return;
      }

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.style.filter = 'grayscale(.1) opacity(.85)';
      setStatus('ì €ì¥ ì¤‘ì…ë‹ˆë‹¤â€¦ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');

      const payload = {
        customerName, phone, postcode, baseAddress, detailAddress, fullAddress, request,
        website
      };

      try {
        const response = await fetch(submitUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        // âœ… ì‘ë‹µì´ ë¹„ì–´ìˆê±°ë‚˜ JSONì´ ê¹¨ì ¸ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
const raw = await response.text();
let result = {};
try { result = raw ? JSON.parse(raw) : {}; } catch { result = {}; }

        if (response.ok) {
          const receiptTitle = result.receiptTitle || result.receipt || '';
          const now = new Date();
          const timeText = `${now.getFullYear()}. ${now.getMonth()+1}. ${now.getDate()}. ${now.toLocaleTimeString('ko-KR')}`;

          // ì ‘ìˆ˜ì¦ ê°’ ì±„ìš°ê¸°(ë¸”ë¼ì¸ë”© ì—†ìŒ)
          document.getElementById('r_receipt').textContent = receiptTitle || '(ì ‘ìˆ˜ë²ˆí˜¸ ì—†ìŒ)';
          document.getElementById('r_time').textContent = timeText;
          document.getElementById('r_name').textContent = customerName;
          document.getElementById('r_phone').textContent = phone;
          document.getElementById('r_address').textContent = fullAddress;
          document.getElementById('r_request').textContent = request || 'ì—†ìŒ';

          // ì ‘ìˆ˜ì¡°íšŒ ë§í¬(í•´ì‹œë¡œ ìë™ì…ë ¥)
          const statusHref = `./status.html#receipt=${encodeURIComponent(receiptTitle)}`;
          document.getElementById('r_statusLink').href = statusHref;
          document.getElementById('goStatusBtn').href = statusHref;
          document.getElementById('topStatusLink').href = statusHref;

          // ë²„íŠ¼ ë™ì‘ ì €ì¥ìš©
          document.getElementById('copyReceiptBtn').onclick = async () => {
            const ok = await copyText(receiptTitle);
            setReceiptStatus(ok ? 'âœ… ì ‘ìˆ˜ë²ˆí˜¸ë¥¼ ë³µì‚¬í–ˆì–´ìš”.' : 'âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”.', ok ? 'ok' : 'bad');
          };

          document.getElementById('savePngBtn').onclick = () => {
            downloadReceiptPng({
              receiptTitle,
              timeText,
              name: customerName,
              phone,
              address: fullAddress,
              request: request || 'ì—†ìŒ'
            });
            setReceiptStatus('âœ… ì ‘ìˆ˜ì¦ ì €ì¥ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'ok');
          };
/*
          document.getElementById('newEntryBtn').onclick = () => {
            // í¼ ì´ˆê¸°í™”
            document.getElementById('form').reset();
            document.getElementById('postcode').value = '';
            document.getElementById('baseAddress').value = '';
            document.getElementById('fullAddress').value = '';
            setStatus('');
            setReceiptStatus('');
            clearErrors();
            showFormScreen();
          };
*/
          // í¼ í™”ë©´ ìˆ¨ê¸°ê³  ì ‘ìˆ˜ì¦ í™”ë©´ë§Œ ë³´ì—¬ì£¼ê¸°(ìš”ì²­ì‚¬í•­)
          showReceiptScreen();
        } else {
          setStatus(`âŒ ì €ì¥ ì‹¤íŒ¨: ${result.error || 'Notion save failed'}`, 'bad');
        }
      } catch (error) {
        setStatus('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'bad');
      } finally {
        btn.disabled = false;
        btn.style.filter = '';
      }
    });
  </script>
</body>
</html>
