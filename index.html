<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¶œê³  ì •ë³´ ì…ë ¥</title>
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; max-width: 640px; margin: 40px auto; padding: 20px; }
    label { display:block; font-weight:600; margin-top:14px; margin-bottom:6px; }
    input, textarea, button { width:100%; box-sizing:border-box; font-size:16px; }
    input, textarea { padding:10px 12px; border:1px solid #d1d5db; border-radius:8px; }
    .readonly { background:#f3f4f6; }
    .btn { background:#4f46e5; color:#fff; border:none; padding:12px 16px; border-radius:8px; cursor:pointer; margin-top:10px; }
    .hidden { display:none; }
    .status { margin-top:14px; font-size:14px; }
  </style>
</head>
<body>
  <h1>ğŸ“¦ ì¶œê³  ì •ë³´ ì…ë ¥</h1>

  <form id="form">
    <label>ê³ ê°ëª…</label>
    <input type="text" id="customerName" required />

    <label>ì—°ë½ì²˜</label>
    <input type="tel" id="phone" placeholder="ì˜ˆ: 010-1234-5678" required />

    <div class="hidden">
      <label>Website</label>
      <input type="text" id="website" autocomplete="off" />
    </div>

    <label>ìš°í¸ë²ˆí˜¸</label>
    <input type="text" id="postcode" class="readonly" readonly required />
    <button type="button" class="btn" onclick="findAddress()">ì£¼ì†Œ ê²€ìƒ‰</button>

    <label>ê¸°ë³¸ì£¼ì†Œ</label>
    <input type="text" id="baseAddress" class="readonly" readonly required />

    <label>ìƒì„¸ì£¼ì†Œ</label>
    <input type="text" id="detailAddress" placeholder="ë™/í˜¸, ìƒí˜¸ëª…, ì¸µìˆ˜ ë“±" />

    <label>ì „ì²´ì£¼ì†Œ</label>
    <input type="text" id="fullAddress" class="readonly" readonly required />

    <label>ìš”ì²­ì‚¬í•­</label>
    <textarea id="request" rows="4" placeholder="ë°°ì†¡ ìš”ì²­ì‚¬í•­"></textarea>

    <button type="submit" class="btn">âœ… ë…¸ì…˜ì— ì €ì¥</button>
    <div class="status" id="status"></div>
  </form>

  <script>
    const submitUrl = '/api/submit';

    function updateFullAddress() {
      const base = document.getElementById('baseAddress').value.trim();
      const detail = document.getElementById('detailAddress').value.trim();
      document.getElementById('fullAddress').value = detail ? `${base} ${detail}` : base;
    }

    function findAddress() {
      new daum.Postcode({
        oncomplete: (data) => {
          document.getElementById('postcode').value = data.zonecode || '';
          document.getElementById('baseAddress').value = data.address || '';
          updateFullAddress();
          document.getElementById('detailAddress').focus();
        }
      }).open();
    }

    document.getElementById('detailAddress').addEventListener('input', updateFullAddress);

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const status = document.getElementById('status');
      status.textContent = 'ì €ì¥ ì¤‘...';

      const data = {
        customerName: document.getElementById('customerName').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        postcode: document.getElementById('postcode').value.trim(),
        baseAddress: document.getElementById('baseAddress').value.trim(),
        detailAddress: document.getElementById('detailAddress').value.trim(),
        fullAddress: document.getElementById('fullAddress').value.trim(),
        request: document.getElementById('request').value.trim(),
        website: document.getElementById('website').value.trim()
      };

      try {
        const res = await fetch(submitUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          status.textContent = `âœ… ì €ì¥ ì™„ë£Œ (ì ‘ìˆ˜ë²ˆí˜¸: ${result.receiptTitle})`;
          document.getElementById('form').reset();
        } else {
          status.textContent = `âŒ ì €ì¥ ì‹¤íŒ¨: ${result.error || 'ì˜¤ë¥˜'}`;
        }
      } catch {
        status.textContent = 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
      }
    });
  </script>
</body>
</html>
